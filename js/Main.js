function onLoad(){gWebSearch=new GwebSearch,gWebSearch.setResultSetSize(GSearch.SMALL_RESULTSET),gWebSearch.setSearchCompleteCallback(null,onWebSearch),""!=document.getElementById("q").value&&search()}function onWebSearch(){if(imFeelingLuckyMode)return location.href=gWebSearch.results[0].unescapedUrl,void 0;for(var e=0;e<gWebSearch.results.length;e++)addResult(gWebSearch.results[e])}function init(){for(canvas=document.getElementById("canvas"),document.onmousedown=onDocumentMouseDown,document.onmouseup=onDocumentMouseUp,document.onmousemove=onDocumentMouseMove,document.ondblclick=onDocumentDoubleClick,document.onkeypress=onDocumentKeyPress,document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),document.addEventListener("touchend",onDocumentTouchEnd,!1),worldAABB=new b2AABB,worldAABB.minVertex.Set(-200,-200),worldAABB.maxVertex.Set(screen.width+200,screen.height+200),world=new b2World(worldAABB,new b2Vec2(0,0),!0),setWalls(),elements=getElementsByClass("box2d"),i=0;i<elements.length;i++){var e=elements[i];properties[i]=findPos(e),properties[i][2]=e.offsetWidth,properties[i][3]=e.offsetHeight}for(i=0;i<elements.length;i++){var e=elements[i];e.style.position="absolute",e.style.left=properties[i][0]+"px",e.style.top=properties[i][1]+"px",e.onmousedown=onElementMouseDown,e.onmouseup=onElementMouseUp,e.onclick=onElementClick,bodies[i]=createBox(world,properties[i][0]+(properties[i][2]>>1),properties[i][1]+(properties[i][3]>>1),properties[i][2]/2,properties[i][3]/2,!1)}}function run(){isRunning=!0,setInterval(loop,25)}function onDocumentMouseDown(){return isMouseDown=!0,!1}function onDocumentMouseUp(){return isMouseDown=!1,!1}function onDocumentMouseMove(){isRunning||run(),mouseX=window.event.clientX,mouseY=window.event.clientY}function onDocumentDoubleClick(){reset()}function onDocumentKeyPress(e){13==e.charCode&&search()}function onDocumentTouchStart(e){if(1==e.touches.length){e.preventDefault(),isRunning||run();var t=(new Date).getTime();if(250>t-timeOfLastTouch)return reset(),void 0;timeOfLastTouch=t,mouseX=e.touches[0].pageX,mouseY=e.touches[0].pageY,isMouseDown=!0}}function onDocumentTouchMove(e){1==e.touches.length&&(e.preventDefault(),mouseX=e.touches[0].pageX,mouseY=e.touches[0].pageY)}function onDocumentTouchEnd(e){0==e.touches.length&&(e.preventDefault(),isMouseDown=!1)}function onElementMouseDown(){return mouseOnClick[0]=window.event.clientX,mouseOnClick[1]=window.event.clientY,!1}function onElementMouseUp(){return!1}function onElementClick(){var e=5;return mouseOnClick[0]>window.event.clientX+e||mouseOnClick[0]<window.event.clientX-e&&mouseOnClick[1]>window.event.clientY+e||mouseOnClick[1]<window.event.clientY-e?!1:(this==document.getElementById("btnG")&&search(),this==document.getElementById("btnI")&&imFeelingLucky(),this==document.getElementById("q")&&document.f.q.focus(),void 0)}function search(){return isRunning||run(),onDocumentDoubleClick(),gWebSearch.execute(document.getElementById("q").value),!1}function imFeelingLucky(){return imFeelingLuckyMode=!0,gWebSearch.execute(document.getElementById("q").value),!1}function addResult(e){var t=document.createElement("div");t.innerHTML='<div><h3 class=r><a href="'+e.unescapedUrl+"\" class=l onmousedown=\"return clk(this.href,'','','res','1','&amp;sig2=3Ti89FTuSYfE6a-5k1jjKQ')\">"+e.title+'</a></h3><span style=display:inline-block><button class=w10 title="Promote"></button><button class=w20 title="Remove"></button></span><div class="s">'+e.content+"<br><cite>"+e.visibleUrl+"</cite></div>",canvas.appendChild(t),properties.push([Math.random()*(window.innerWidth/2),-200,600,t.offsetHeight]);var o=properties.length-1;t.style.position="absolute",t.style.left="0px",t.style.top="-100px",t.style.backgroundColor="#ffffff",t.onmousedown=onElementMouseDown,t.onmouseup=onElementMouseUp,t.onclick=onElementClick,elements[o]=t,resultBodies.push(bodies[o]=createBox(world,properties[o][0]+(properties[o][2]>>1),properties[o][1]+(properties[o][3]>>1),properties[o][2]/2,properties[o][3]/2,!1,t))}function reset(){for(i=0;i<resultBodies.length;i++){var e=resultBodies[i];canvas.removeChild(e.GetUserData().element),world.DestroyBody(e),e=null}resultBodies=new Array}function loop(){for(getBrowserDimensions()&&setWalls(),delta[0]+=.5*(0-delta[0]),delta[1]+=.5*(0-delta[1]),world.m_gravity.x=0+delta[0],world.m_gravity.y=350+delta[1],mouseDrag(),world.Step(timeStep,iterations),i=0;i<elements.length;i++){var e=bodies[i],t=elements[i];t.style.left=e.m_position0.x-(properties[i][2]>>1)+"px",t.style.top=e.m_position0.y-(properties[i][3]>>1)+"px";var o="rotate("+57.2957795*e.m_rotation0+"deg)";t.style.WebkitTransform=o,t.style.MozTransform=o,t.style.OTransform=o}}function createBox(e,t,o,n,s,i,r){"undefined"==typeof i&&(i=!0);var l=new b2BoxDef;i||(l.density=1),l.extents.Set(n,s);var u=new b2BodyDef;return u.AddShape(l),u.position.Set(t,o),u.userData={element:r},e.CreateBody(u)}function mouseDrag(){if(isMouseDown&&!mouseJoint){var e=getBodyAtMouse();if(e){var t=new b2MouseJointDef;t.body1=world.m_groundBody,t.body2=e,t.target.Set(mouseX,mouseY),t.maxForce=3e4*e.m_mass,t.timeStep=timeStep,mouseJoint=world.CreateJoint(t),e.WakeUp()}}if(isMouseDown||mouseJoint&&(world.DestroyJoint(mouseJoint),mouseJoint=null),mouseJoint){var o=new b2Vec2(mouseX,mouseY);mouseJoint.SetTarget(o)}}function getBodyAtMouse(){var e=new b2Vec2;e.Set(mouseX,mouseY);var t=new b2AABB;t.minVertex.Set(mouseX-1,mouseY-1),t.maxVertex.Set(mouseX+1,mouseY+1);for(var o=10,n=new Array,s=world.Query(t,n,o),i=null,r=0;s>r;++r)if(0==n[r].m_body.IsStatic()&&n[r].TestPoint(e)){i=n[r].m_body;break}return i}function setWalls(){wallsSetted&&(world.DestroyBody(walls[0]),world.DestroyBody(walls[1]),world.DestroyBody(walls[2]),world.DestroyBody(walls[3]),walls[0]=null,walls[1]=null,walls[2]=null,walls[3]=null),walls[0]=createBox(world,stage[2]/2,-wall_thickness,stage[2],wall_thickness),walls[1]=createBox(world,stage[2]/2,stage[3]+wall_thickness,stage[2],wall_thickness),walls[2]=createBox(world,-wall_thickness,stage[3]/2,wall_thickness,stage[3]),walls[3]=createBox(world,stage[2]+wall_thickness,stage[3]/2,wall_thickness,stage[3]),wallsSetted=!0}function getElementsByClass(e){var t=new Array,o=document.getElementsByTagName("*"),n=o.length;for(i=0,j=0;n>i;i++){var s=o[i].className.split(" ");for(k=0;k<s.length;k++)s[k]==e&&(t[j++]=o[i])}return t}function findPos(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function getBrowserDimensions(){var e=!1;return stage[0]!=window.screenX&&(delta[0]=50*(window.screenX-stage[0]),stage[0]=window.screenX,e=!0),stage[1]!=window.screenY&&(delta[1]=50*(window.screenY-stage[1]),stage[1]=window.screenY,e=!0),stage[2]!=window.innerWidth&&(stage[2]=window.innerWidth,e=!0),stage[3]!=window.innerHeight&&(stage[3]=window.innerHeight,e=!0),e}var canvas,delta=[0,0],stage=[window.screenX,window.screenY,window.innerWidth,window.innerHeight];getBrowserDimensions();var isRunning=!1,isMouseDown=!1,worldAABB,world,iterations=1,timeStep=.04,walls=new Array,wall_thickness=200,wallsSetted=!1,mouseJoint,mouseX=0,mouseY=0,mouseOnClick=new Array,timer=0,elements=new Array,bodies=new Array,properties=new Array,gWebSearch,imFeelingLuckyMode=!1,resultBodies=new Array;if(init(),""!=location.search)for(var params=location.search.substr(1).split("&"),i=0;i<params.length;i++){var param=params[i].split("=");if("q"==param[0]){document.getElementById("q").value=param[1],run();break}}