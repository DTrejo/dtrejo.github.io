<!DOCTYPE html>
<html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/images/favicon.png?1515647660" rel="icon" type="image/png" /><link href="https://dtrejo.com/feed.xml" rel="alternate" title="David Trejo | Developer and Consultant Feed" type="application/atom+xml" /><title>Node Single Point of Failure by David Trejo | Developer and Consultant</title><link href="https://dtrejo.com/node-single-point-of-failure.html" rel="canonical" /><meta content="nodejs, voxer" name="keywords" /><link href="/stylesheets/application.css?1492155547" media="screen" rel="stylesheet" type="text/css" /><link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" /></head><body><nav class="navbar navbar-default navbar-static-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><h2><a class="navbar-brand" href="https://dtrejo.com/">dtrejo.com</a></h2></div><div class="collapse navbar-collapse"><ul class="navbar-nav nav navbar-right"><li><a href="https://twitter.com/ddtrejo"><i class='fa fa-twitter fa-inline'></i> ddtrejo</a></li></ul></div></div></nav><div class="container"><article><h1 class="article-title">Node Single Point of Failure</h1><div class="article-body"><p><img alt="" width="252" height="58" src="https://dtrejo.com/images/46879900-Voxer_Logo.png?1467608547" /></p>

<p><em>Note: written in August 2012 during my summer at Voxer. <code>sky</code> has been released
as [zag][5]!</em></p>

<p>Voxer believes that any single point of failure is bad. Very bad (this is why we
use riak). To achieve this, we've written a couple libraries to allow node
processes to communicate across machines and in concert. The first is
<a href="https://github.com/dannycoates/poolee">poolee</a> by <a href="https://github.com/dannycoates">Danny Coates</a> which does http load balancing on the client,
and the second is [ring][3]*, which organizes processes that compose a service
into a cooperating whole (each process owns part of the keyspace, and thus part
of the work).</p>

<p>Here's how this looks:</p>

<p><img alt="" width="499" height="388" src="https://dtrejo.com/images/46879717-nospof.png?1482632847" /></p>

<p>Requests emanate from clients via <a href="https://github.com/dannycoates/poolee">poolee</a>, which has a list of all API
servers. Poolee chooses a random API server to speak with, and will stop talking
to the API server if it becomes unresponsive. Health checks on unresponsive
servers are performed with using exponential backoff (e.g. 1 second, 8 seconds,
16 seconds, etc), so as not to flood the network.</p>

<p>The ring of API servers kicks in! Each client request has a distinguishing
characteristic (e.g. geographic region), which dictates a specific API server as
the "home" or "owner" of that data, and it is tasked with responding to that
request. You may have noticed that poolee chooses a <em>random</em> node, but it turns
our that this random node knows it is not the owner of the request, and can
forward it to the true "home" node of that request.</p>

<p><code>ring</code> is consistent, which means that when an API server goes down, the other
servers will fill in for the downed server without changing the homes of data
stored on any nodes other than one neighboring node. The efficiency of home
re-shuffling is what makes the ring consistent. If this doesn't make sense, it is
because it's difficult to explain, wikipedia does a better job of explaining
<a href="https://en.wikipedia.org/wiki/Consistent_hashing">consistent hash rings</a>.</p>

<h2 id="failure">Failure</h2>
<p>Poolee and ring work together and allow us to do rolling restarts without
service interruption, restart single machines when SSL has memory leaks,
and remove machines from our clusters.</p>

<p>Thus, Voxer achieves a no single point of failure architecture using the
power of <a href="http://nodejs.org">node.js</a>.</p>

<p>Thanks for reading!<br />
<a href="https://dtrejo.com">David Trejo</a><br />
<a href="https://twitter.com/ddtrejo">@ddtrejo</a> &amp; <a href="https://github.com/DTrejo">DTrejo on github</a></p>

</div></article><div class="media author"><div class="pull-left"><img class="media-object img-circle author-avatar" src="/images/dtrejo.jpg" /></div><div class="media-body"><h4 class="media-heading author-name"><a href="/">David Trejo</a></h4><span class="author-desc">Growth Engineer at Credit Karma &amp; Consultant. Past clients include Aconex, Triplebyte, Neo, Brown Computer Science Department, Voxer, Cloudera, and the Veteran's Benefits Administration.</span></div></div><div class="comments"><div class="article-footer"><form action="https://www.getdrip.com/forms/761954876/submissions" data-drip-embedded-form="761954876" method="post"><h2 data-drip-attribute="headline"> Want to be a better Full Stack Growth Engineer?</h2><div data-drip-attribute="description"> You'll get articles with everything I learn as a growth engineer at Credit Karma, a profitable private company with &gt;75 million members, &gt;$1 billion valuation, and &gt;500 employees.</div><p><br /><label for="drip-email"> My email is</label><input id="drip-email" name="fields[email]" placeholder="Email" type="email" value="" />.</p><div class="g-recaptcha" data-sitekey="6Lde4yAUAAAAAJmNA-cp7ySkBKDmf3NhprEn8Y8Z"></div><div><input class="btn-6 btn-6a" data-drip-attribute="sign-up-button" type="submit" value="Get Helpful Growth Engineering Articles" /></div></form></div></div></div><footer><div class="container"><div class="col-md-6"><em>Find me</em><br /><br /><a href="https://github.com/DTrejo">Github</a><br /><a href="https://twitter.com/ddtrejo">Twitter</a><br /><a href="#" id="email" title="david at this domain">Email</a></div><span class="fin col-md-12 text-center"><a href="404.html">fin</a></span></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script><script type="text/javascript">$(document).ready(function() {
  // Show email to humans.
  var me = 'david'
  var atDomain = '@dtrejo.com'
  $('a#email').click(function() {
    $(this).attr('href', 'mailto:' + me + atDomain).text(me + atDomain)
  })
})</script><script src="/javascripts/application.js?1467608550" type="text/javascript"></script>
<script type="text/javascript">var _dcq = _dcq || [];
var _dcs = _dcs || {};
_dcs.account = '7413888';
(function() {
  var dc = document.createElement('script');
  dc.type = 'text/javascript'; dc.async = true;
  dc.src = '//tag.getdrip.com/7413888.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(dc, s);
})();</script><script async="" defer="" src="https://www.google.com/recaptcha/api.js"></script><script type="text/javascript">      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-11131137-1', 'dtrejo.com');
      ga('send', 'pageview');
</script></body></html>